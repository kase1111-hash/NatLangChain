# NatLangChain Environment Configuration
# Copy this file to .env and configure as needed

# =============================================================================
# LLM Configuration (Required for validation features)
# =============================================================================
# Anthropic API key for Proof of Understanding validation, contract parsing,
# intent classification, and PoU scoring
# Get your key at: https://console.anthropic.com/
ANTHROPIC_API_KEY=your_api_key_here

# Local cache directory for sentence-transformer model files
# Set to avoid runtime downloads in air-gapped or CI environments
# SENTENCE_TRANSFORMERS_HOME=/opt/models

# =============================================================================
# Server Configuration
# =============================================================================
# Port reported by the scaling coordinator for instance registration
PORT=5000

# Reported in /health endpoint â€” does NOT control Flask's actual debug mode
FLASK_DEBUG=false

# =============================================================================
# Storage Backend
# =============================================================================
# Options: json (default), postgresql/postgres, memory
STORAGE_BACKEND=json
CHAIN_DATA_FILE=chain_data.json

# PostgreSQL connection (required when STORAGE_BACKEND=postgresql)
# DATABASE_URL=postgresql://user:password@localhost:5432/natlangchain

# =============================================================================
# Authentication
# =============================================================================
# API key for client authentication (X-API-Key header)
# Generate: python -c "import secrets; print(secrets.token_urlsafe(32))"
NATLANGCHAIN_API_KEY=
NATLANGCHAIN_REQUIRE_AUTH=true

# =============================================================================
# Data Encryption (Optional)
# =============================================================================
# AES-256-GCM at-rest encryption for chain entries
# Key must be >= 16 characters
# Generate: python -c "from src.encryption import generate_encryption_key; print(generate_encryption_key())"
NATLANGCHAIN_ENCRYPTION_KEY=
NATLANGCHAIN_ENCRYPTION_ENABLED=true

# =============================================================================
# Security
# =============================================================================
# Comma-separated list of permitted CORS origins; empty string blocks cross-origin
# CORS_ALLOWED_ORIGINS=https://example.com,https://app.example.com

# Add Strict-Transport-Security header (enable when behind HTTPS termination)
NATLANGCHAIN_ENABLE_HSTS=false

# Comma-separated proxy IPs whose X-Forwarded-For header is trusted
# NATLANGCHAIN_TRUSTED_PROXIES=10.0.0.1,10.0.0.2

# Outbound LLM response scanning for accidentally leaked secrets
NATLANGCHAIN_SECRET_SCANNING=true
# Scan mode: "redact" replaces detected secrets, "block" rejects the response
NATLANGCHAIN_SECRET_SCAN_MODE=redact

# =============================================================================
# Cryptographic Identity & Signing (Optional)
# =============================================================================
# Enable Ed25519 signing of chain entries
NATLANGCHAIN_IDENTITY_ENABLED=false
# Reject unsigned entries during verification
NATLANGCHAIN_REQUIRE_SIGNATURES=false
# Path to the identity keystore file
# NATLANGCHAIN_IDENTITY_KEYSTORE=/path/to/keystore.json
# Passphrase for the keystore (treat as secret)
# NATLANGCHAIN_IDENTITY_PASSPHRASE=

# =============================================================================
# Rate Limiting
# =============================================================================
# Global rate limit: max requests per IP within the window
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60

# Stricter limits for LLM-backed endpoints (validation, contract parsing)
LLM_RATE_LIMIT_REQUESTS=10
LLM_RATE_LIMIT_WINDOW=60

# =============================================================================
# API Pagination
# =============================================================================
NATLANGCHAIN_DEFAULT_PAGE_LIMIT=100
NATLANGCHAIN_MAX_PAGE_LIMIT=1000
NATLANGCHAIN_DEFAULT_HISTORY_LIMIT=50

# =============================================================================
# Logging
# =============================================================================
# Python logging level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO
# Set to "json" for structured JSON output; anything else uses console format
LOG_FORMAT=console

# =============================================================================
# Retry Logic
# =============================================================================
RETRY_MAX_ATTEMPTS=3
RETRY_BASE_DELAY=1.0
RETRY_MAX_DELAY=60.0
RETRY_EXPONENTIAL_BASE=2.0
RETRY_JITTER=0.1

# =============================================================================
# Scaling / Distributed Infrastructure (Optional)
# =============================================================================
# Redis URL for distributed caching, locking, and coordination
# When unset, falls back to in-process mode (single-instance only)
# REDIS_URL=redis://localhost:6379/0

# =============================================================================
# Module Manifests (Optional)
# =============================================================================
# Directory containing module capability manifest YAML files
NATLANGCHAIN_MANIFEST_DIR=src/manifests
# When true, rejects API requests targeting unregistered modules
NATLANGCHAIN_MANIFEST_ENFORCE=false

# =============================================================================
# Graceful Shutdown
# =============================================================================
SHUTDOWN_TIMEOUT=30
