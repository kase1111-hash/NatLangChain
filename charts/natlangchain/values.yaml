# Default values for natlangchain.
# This is a YAML-formatted file.

# =============================================================================
# Global Settings
# =============================================================================
global:
  # Image pull secrets for private registries
  imagePullSecrets: []
  # Storage class for persistent volumes
  storageClass: ""

# =============================================================================
# NatLangChain Application
# =============================================================================
replicaCount: 2

image:
  repository: ghcr.io/kase1111-hash/natlangchain
  pullPolicy: IfNotPresent
  # Overrides the image tag (default is appVersion)
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# =============================================================================
# Service Account
# =============================================================================
serviceAccount:
  # Create a service account
  create: true
  # Annotations for the service account
  annotations: {}
  # Name override (generated if not set)
  name: ""

# =============================================================================
# Pod Configuration
# =============================================================================
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "5000"
  prometheus.io/path: "/metrics"

podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

# =============================================================================
# Service Configuration
# =============================================================================
service:
  type: ClusterIP
  port: 80
  targetPort: 5000
  annotations: {}

# =============================================================================
# Ingress Configuration
# =============================================================================
ingress:
  enabled: false
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: natlangchain.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: natlangchain-tls
  #    hosts:
  #      - natlangchain.local

# =============================================================================
# Resource Limits
# =============================================================================
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 512Mi

# =============================================================================
# Autoscaling
# =============================================================================
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 10
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Percent
          value: 100
          periodSeconds: 15
        - type: Pods
          value: 4
          periodSeconds: 15
      selectPolicy: Max

# =============================================================================
# Pod Disruption Budget
# =============================================================================
podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 1

# =============================================================================
# Node Selection
# =============================================================================
nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - natlangchain
          topologyKey: kubernetes.io/hostname

# =============================================================================
# Health Probes
# =============================================================================
livenessProbe:
  httpGet:
    path: /health/live
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

readinessProbe:
  httpGet:
    path: /health/ready
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

startupProbe:
  httpGet:
    path: /health/live
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30
  successThreshold: 1

# =============================================================================
# Application Configuration
# =============================================================================
config:
  # Flask settings
  flaskEnv: production
  flaskDebug: false
  secretKey: ""  # Will be auto-generated if empty

  # API settings
  apiRateLimit: "100/minute"
  apiTimeout: 30

  # Blockchain settings
  miningDifficulty: 4
  chainValidationInterval: 300

  # Security settings
  boundaryMode: "standard"  # open, standard, elevated, restricted, lockdown
  enableRbac: true
  jwtSecretKey: ""  # Will be auto-generated if empty
  jwtAccessTokenExpires: 3600

  # Tracing
  enableTracing: false
  otlpEndpoint: ""
  tracingSampleRate: 0.1

  # Logging
  logLevel: INFO
  logFormat: json

# =============================================================================
# External Secrets (use existing secrets)
# =============================================================================
existingSecrets:
  # Use existing secret for app secrets
  appSecret: ""
  # Use existing secret for database credentials
  dbSecret: ""
  # Use existing secret for Redis credentials
  redisSecret: ""

# =============================================================================
# Persistence
# =============================================================================
persistence:
  enabled: true
  storageClass: ""
  accessModes:
    - ReadWriteOnce
  size: 10Gi
  annotations: {}
  # Existing PVC to use
  existingClaim: ""

# =============================================================================
# Redis Configuration
# =============================================================================
redis:
  enabled: true
  # Use external Redis instead
  external:
    enabled: false
    host: ""
    port: 6379
    password: ""
    # Use existing secret for password
    existingSecret: ""
    existingSecretPasswordKey: "redis-password"

  # Bitnami Redis subchart values
  architecture: standalone
  auth:
    enabled: true
    password: ""
  master:
    persistence:
      enabled: true
      size: 8Gi

# =============================================================================
# PostgreSQL Configuration
# =============================================================================
postgresql:
  enabled: false
  # Use external PostgreSQL instead
  external:
    enabled: false
    host: ""
    port: 5432
    database: natlangchain
    username: natlangchain
    password: ""
    # Use existing secret
    existingSecret: ""
    existingSecretPasswordKey: "postgresql-password"

  # Bitnami PostgreSQL subchart values
  auth:
    username: natlangchain
    password: ""
    database: natlangchain
  primary:
    persistence:
      enabled: true
      size: 20Gi

# =============================================================================
# Monitoring
# =============================================================================
metrics:
  enabled: true
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    honorLabels: false

  prometheusRule:
    enabled: false
    namespace: ""
    labels: {}
    # Additional rules
    additionalRules: []

# =============================================================================
# Network Policies
# =============================================================================
networkPolicy:
  enabled: false
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
      ports:
        - protocol: TCP
          port: 5000
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6379
        - protocol: TCP
          port: 5432

# =============================================================================
# Init Containers
# =============================================================================
initContainers: []
  # - name: wait-for-redis
  #   image: busybox:1.36
  #   command: ['sh', '-c', 'until nc -z redis 6379; do sleep 1; done']

# =============================================================================
# Sidecar Containers
# =============================================================================
sidecars: []
  # - name: log-shipper
  #   image: fluent/fluent-bit:latest
  #   volumeMounts:
  #     - name: logs
  #       mountPath: /var/log/app

# =============================================================================
# Extra Environment Variables
# =============================================================================
extraEnv: []
  # - name: EXTRA_VAR
  #   value: "extra-value"

extraEnvFrom: []
  # - secretRef:
  #     name: extra-secrets

# =============================================================================
# Extra Volumes
# =============================================================================
extraVolumes: []
  # - name: extra-config
  #   configMap:
  #     name: extra-configmap

extraVolumeMounts: []
  # - name: extra-config
  #   mountPath: /etc/extra

# =============================================================================
# Jobs
# =============================================================================
migrations:
  enabled: false
  # Run migrations as a pre-install/pre-upgrade hook
  hookEnabled: true
  image: {}  # Uses main image if not specified
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

backup:
  enabled: false
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 7
  storage:
    # s3, gcs, or azure
    type: s3
    bucket: ""
    prefix: "natlangchain-backups"
    # Use existing secret for credentials
    existingSecret: ""
